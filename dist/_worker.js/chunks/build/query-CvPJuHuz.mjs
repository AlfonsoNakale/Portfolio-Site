import{Buffer as e}from"node:buffer";import{a0 as r,w as t,F as n,H as s}from"../_/nitro.mjs";import{h as i}from"../_/index2.mjs";import{a as o,c as a}from"./server.mjs";import{u}from"./preview-lsRfUkkH.mjs";const get=(e,r)=>r.split(".").reduce((e,r)=>e&&e[r],e),_pick=(e,r)=>Object.keys(e).filter(r).reduce((r,t)=>Object.assign(r,{[t]:e[t]}),{}),omit=e=>r=>e&&e.length?_pick(r,r=>!e.includes(r)):r,apply=e=>r=>Array.isArray(r)?r.map(r=>e(r)):e(r),detectProperties=e=>{const r=[],t=[];for(const n of e)["$","_"].includes(n)?r.push(n):t.push(n);return{prefixes:r,properties:t}},withoutKeys=(e=[])=>r=>{if(0===e.length||!r)return r;const{prefixes:t,properties:n}=detectProperties(e);return _pick(r,e=>!n.includes(e)&&!t.includes(e[0]))},withKeys=(e=[])=>r=>{if(0===e.length||!r)return r;const{prefixes:t,properties:n}=detectProperties(e);return _pick(r,e=>n.includes(e)||t.includes(e[0]))},sortList=(e,r)=>{const t=new Intl.Collator(r.$locale,{numeric:r.$numeric,caseFirst:r.$caseFirst,sensitivity:r.$sensitivity}),n=Object.keys(r).filter(e=>!e.startsWith("$"));for(const s of n)e=e.sort((e,n)=>{const i=[get(e,s),get(n,s)].map(e=>{if(null!==e)return e instanceof Date?e.toISOString():e});return-1===r[s]&&i.reverse(),t.compare(i[0],i[1])});return e},assertArray=(e,r="Expected an array")=>{if(!Array.isArray(e))throw new TypeError(r)},ensureArray=e=>Array.isArray(e)?e:[void 0,null].includes(e)?[]:[e],l=["sort","where","only","without"];function createQuery(e,r={}){const t={};for(const e of Object.keys(r.initialParams||{}))t[e]=l.includes(e)?ensureArray(r.initialParams[e]):r.initialParams[e];const $set=(e,r=e=>e)=>(...s)=>(t[e]=r(...s),n),resolveResult=e=>{var t;return r.legacy?(null==e?void 0:e.surround)?e.surround:e?((null==e?void 0:e.dirConfig)&&(e.result={_path:null==(t=e.dirConfig)?void 0:t._path,...e.result,_dir:e.dirConfig}),(null==e?void 0:e._path)||Array.isArray(e)||!Object.prototype.hasOwnProperty.call(e,"result")?e:null==e?void 0:e.result):e:e},n={params:()=>({...t,...t.where?{where:[...ensureArray(t.where)]}:{},...t.sort?{sort:[...ensureArray(t.sort)]}:{}}),only:$set("only",ensureArray),without:$set("without",ensureArray),where:$set("where",e=>[...ensureArray(t.where),...ensureArray(e)]),sort:$set("sort",e=>[...ensureArray(t.sort),...ensureArray(e)]),limit:$set("limit",e=>parseInt(String(e),10)),skip:$set("skip",e=>parseInt(String(e),10)),find:()=>e(n).then(resolveResult),findOne:()=>e($set("first")(!0)).then(resolveResult),count:()=>e($set("count")(!0)).then(resolveResult),locale:e=>n.where({_locale:e}),withSurround:$set("surround",(e,r)=>({query:e,...r})),withDirConfig:()=>$set("dirConfig")(!0)};return r.legacy?(n.findSurround=(e,r)=>n.withSurround(e,r).find().then(resolveResult),n):n}function jsonStringify(e){return JSON.stringify(e,regExpReplacer)}function regExpReplacer(e,r){return r instanceof RegExp?`--REGEX ${r.toString()}`:r}const encodeQueryParams=r=>{let t=jsonStringify(r);t=void 0!==e?e.from(t).toString("base64"):btoa(t),t=t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return(t.match(/.{1,100}/g)||[]).join("/")},withContentBase=e=>r(e,o().public.content.api.baseURL),useContentDisabled=()=>{throw console.warn("useContent is only accessible when you are using `documentDriven` mode."),console.warn("Learn more by visiting: https://content.nuxt.com/document-driven"),new Error("useContent is only accessible when you are using `documentDriven` mode.")},addPrerenderPath=e=>{const r=a();r&&r.node.res.setHeader("x-nitro-prerender",[r.node.res.getHeader("x-nitro-prerender"),e].filter(Boolean).join(","))},shouldUseClientDB=()=>{const{experimental:e}=o().public.content;return!1};function queryContent(e,...r){const{content:a}=o().public,l=createQuery(async e=>{const{content:r}=o().public,t=e.params(),n=r.experimental.stripQueryParameters?withContentBase(`/query/${i(t)}.${r.integrity}/${encodeQueryParams(t)}.json`):withContentBase(`/query/${i(t)}.${r.integrity}.json`);if(addPrerenderPath(n),shouldUseClientDB())return(await import("./client-db-DSSyWOo_.mjs").then(e=>e.useContentDatabase())).fetch(e);const s=await $fetch(n,{method:"GET",responseType:"json",params:r.experimental.stripQueryParameters?void 0:{_params:jsonStringify(t),previewToken:u().getPreviewToken()}});if("string"==typeof s&&s.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return s},{initialParams:"string"!=typeof e?e:{},legacy:!0});let c;"string"==typeof e&&(c=t(n(e,...r)));const p=l.params;return l.params=()=>{var e,r,t;const n=p();if(c&&(n.where=n.where||[],n.first&&0===(n.where||[]).length?n.where.push({_path:s(c)}):n.where.push({_path:new RegExp(`^${c.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(null==(e=n.sort)?void 0:e.length)||(n.sort=[{_stem:1,$numeric:!0}]),a.locales.length){(null==(t=null==(r=n.where)?void 0:r.find(e=>e._locale))?void 0:t._locale)||(n.where=n.where||[],n.where.push({_locale:a.defaultLocale}))}return n},l}export{addPrerenderPath as a,ensureArray as b,createQuery as c,apply as d,encodeQueryParams as e,sortList as f,get as g,withoutKeys as h,withKeys as i,jsonStringify as j,assertArray as k,omit as o,queryContent as q,shouldUseClientDB as s,useContentDisabled as u,withContentBase as w};
//# sourceMappingURL=query-CvPJuHuz.mjs.map
