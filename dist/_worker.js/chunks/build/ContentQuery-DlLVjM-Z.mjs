import{h as e}from"../_/index2.mjs";import{u as t}from"./asyncData-Dx1Jrwy3.mjs";import{q as r}from"./query-D_xpVYMB.mjs";import{v as o,a as u}from"./server.mjs";import"node:buffer";import"../_/nitro.mjs";import"node:timers";import"node:events";import"node:process";import"cloudflare:workers";import"./preview-DaGHZvIK.mjs";import"../routes/renderer.mjs";import"../_/shared.esm-bundler.mjs";const n=o.defineComponent({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(n){const{path:i,only:l,without:a,where:d,sort:s,limit:p,skip:v,locale:f,find:m}=o.toRefs(n),h=o.computed(()=>{var e;return null==(e=i.value)?void 0:e.includes("/_")}),y=!u().public.content.experimental.advanceQuery;o.watch(()=>n,()=>w(),{deep:!0});const resolveResult=e=>y?(null==e?void 0:e.surround)?e.surround:(null==e?void 0:e._id)||Array.isArray(e)?e:null==e?void 0:e.result:e.result,{data:c,refresh:w}=await t(`content-query-${e(n)}`,()=>{let e;return e=i.value?r(i.value):r(),l.value&&(e=e.only(l.value)),a.value&&(e=e.without(a.value)),d.value&&(e=e.where(d.value)),s.value&&(e=e.sort(s.value)),p.value&&(e=e.limit(p.value)),v.value&&(e=e.skip(v.value)),f.value&&(e=e.where({_locale:f.value})),"one"===m.value?e.findOne().then(resolveResult):"surround"===m.value?i.value?y?e.findSurround(i.value):e.withSurround(i.value).findOne().then(resolveResult):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),e.find().then(resolveResult)):e.find().then(resolveResult)});return{isPartial:h,data:c,refresh:w}},render(e){var t;const r=o.useSlots(),{data:u,refresh:n,isPartial:i,path:l,only:a,without:d,where:s,sort:p,limit:v,skip:f,locale:m,find:h}=e,y={path:l,only:a,without:d,where:s,sort:p,limit:v,skip:f,locale:m,find:h};if("one"===y.find){if(!u&&(null==r?void 0:r["not-found"]))return r["not-found"]({props:y,...this.$attrs});if((null==r?void 0:r.empty)&&"markdown"===(null==u?void 0:u._type)&&!(null==(t=null==u?void 0:u.body)?void 0:t.children.length))return r.empty({props:y,...this.$attrs})}else if((!u||!u.length)&&(null==r?void 0:r["not-found"]))return r["not-found"]({props:y,...this.$attrs});if(null==r?void 0:r.default)return r.default({data:u,refresh:n,isPartial:i,props:y,...this.$attrs});return c="default",w={data:u,props:y,isPartial:i},o.h("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:c,data:w},null,2));var c,w}}),i=n.setup;n.setup=(e,t)=>{const r=o.useSSRContext();return(r.modules||(r.modules=new Set)).add("node_modules/@nuxt/content/dist/runtime/components/ContentQuery.vue"),i?i(e,t):void 0};export{n as default};
//# sourceMappingURL=ContentQuery-DlLVjM-Z.mjs.map
